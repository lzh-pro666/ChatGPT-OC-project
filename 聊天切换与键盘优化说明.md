聊天切换与键盘滚动交互优化说明

背景
- 切换不同聊天时出现短暂“先回到旧界面，再刷新成新聊天”的闪烁。
- 在输入框聚焦后手动上滑浏览历史，页面仍会被自动拉回到底部（影响浏览体验）。

主要问题与现象
- 界面闪烁：`didSelectChat:` 返回根控制器后，详情页才刷新为新聊天，产生视觉跳变。
- 滚动被打断：输入框成为第一响应者后，即使用户手动上滑，粘底逻辑仍触发导致回到底部。

修改点（概要）
- 预刷新 + 无动画更新，消除切换闪烁。
- 键盘出现/隐藏仅在“接近底部”时粘底。
- 输入框聚焦且不在底部时，禁用自动粘底以尊重用户滚动。

代码改动
1) 详情页：切换聊天的无动画预刷新（文件：`Controller/ChatDetailViewControllerV2.m`）
   - 新增并实现 `- (void)setChat:(id)chat)`：
     - 终止当前流式/思考状态，清空输入与附件状态。
     - 预加载新聊天消息 `fetchMessagesForChat:`。
     - 使用无动画批量刷新（`UIView performWithoutAnimation` + `CATransaction setDisableActions:YES` + `reloadData` + `layoutIfNeeded`）。
     - 首次展示用 `forceScrollToBottomAnimated:NO`，避免动画闪烁。

2) 主控制器：先应用聊天再返回（文件：`Controller/MainViewController.m`）
   - 在 `- (void)didSelectChat:(id)chat` 中：
     - 先调用 `applyChat:` 触发详情页的预刷新。
     - 再执行 `popToRootViewControllerAnimated:YES`，避免“先返回旧界面，再刷新成新聊天”。

3) 键盘联动粘底仅在接近底部时触发（文件：`Controller/ChatDetailViewControllerV2.m`）
   - 新增属性：`stickOnKeyboardChange`（BOOL）。
   - `keyboardWillShow:` 与 `keyboardWillHide:`：
     - 动画前记录是否“接近底部”（`isNearBottomWithTolerance:`）。
     - 仅当接近底部时才触发粘底滚动（`performAutoScrollWithContext:animated:`）。
     - 键盘收起后复位 `stickOnKeyboardChange = NO`。

4) 输入框聚焦时的自动粘底抑制（文件：`Controller/ChatDetailViewControllerV2.m`）
   - 在 `- (BOOL)shouldPerformAutoScroll` 中新增判断：
     - 当 `inputTextView.isFirstResponder == YES` 且当前“不在底部”时，返回 `NO`，避免“点击输入框后上滑依然被强行拉回底部”。

交互效果
- 切换聊天：返回前已完成无动画刷新，视觉无跳变。
- 键盘弹出/收起：仅在接近底部时粘底；用户在中部浏览历史不被打断。
- 输入中浏览历史：输入框聚焦后手动上滑不会被自动拉回。

涉及文件与符号
- `Controller/ChatDetailViewControllerV2.m`
  - `setChat:`、`keyboardWillShow:`、`keyboardWillHide:`、`shouldPerformAutoScroll`
  - 属性：`stickOnKeyboardChange`
- `Controller/MainViewController.m`
  - `didSelectChat:`、`applyChat:`

备注
- 若仍观察到极端情况下的微弱闪烁，可在无动画刷新前后加入短暂 snapshot 过渡或极短交叉淡入（≈0.08s），进一步平滑视觉切换。

